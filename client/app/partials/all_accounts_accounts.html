<div class="page page-all-accounts-accounts">
    <div class="section" ng-class="{'height-hidden': !isChartShown}">
        <zem-chart zem-data="chartData" zem-metric1="chartMetric1" zem-metric2="chartMetric2" zem-metric1-values="options.allAccountsChartMetrics" zem-metric2-values="options.allAccountsChartMetrics" zem-min-date="dateRange.startDate" zem-max-date="dateRange.endDate" zem-on-remove="selectedSourceRemoved(id)" zem-hide-legend="true"></zem-chart>
    </div>

    <div class="section table-ad-group-sources">
        <div class="button-bar">
            <button type="button" class="btn btn-add" ng-click="addAccount()">+ Account</button>
            <div class="loader" ng-show="requestInProgress"></div>
            <span ng-show="added" class="success">Account &quot;{{ addedName }}&quot; has been added.</span>
            <span ng-show="added === false" class="error">An error occurred while adding.</span>
            <zem-custom-table-cols class='pull-right' columns='columns'></zem-custom-table-cols>

            <a id="chart-btn" ng-attr-title="{{ chartBtnTitle }}" class="btn btn-default pull-right" ng-click="toggleChart()"><img ng-src="{{ config.static_url }}/img/chart.svg"></a>

            <span ng-switch="isSyncInProgress">
                <span ng-switch-when="false">
                    <a ng-click="triggerSync()" ng-show="!triggerSyncFailed" id="resync-btn" class="btn btn-default pull-right" title="Sync reporting metrics"><img ng-src="{{ config.static_url }}/img/refresh.svg"></a>
                </span>
                <span ng-switch-when="true">
                    <a id="resync-loader" class="btn btn-default pull-right"><div class="loader"></div></a>
                </span>
            </span>

            <span ng-show="triggerSyncFailed" class="pull-right error">An error has occured while triggering resync</span>

            <div class="clearfix"></div>
        </div>

        <alert type="info" class="alert-sync" ng-show="isSyncRecent === false">
            We are experiencing a delay synchronizing reporting metrics. <span ng-if="!!lastSyncDate">The last successful sync took place {{ lastSyncDate.fromNow() }}.</span> If you have any questions please contact us at <a href="mailto:help@zemanta.com">help@zemanta.com</a>.
        </alert>

        <div class="loader-container">
            <div class="loader" ng-show="rows.length && loadRequestInProgress"></div>

            <div class="table-container">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th class="arrow" ng-class="{ordered: order === '-name', 'ordered-reverse': order === 'name'}"><a href class="col-title order" ng-click="orderRows('name')">Account</a><zem-help-popover ng-if="hasPermission('zemauth.help_view')" content="A partner account." placement="top"></zem-help-popover></th>
                            <th class="text-center arrow" ng-class="{ordered: order === '-status', 'ordered-reverse': order === 'status'}"><a class="col-title order" href ng-click="orderRows('status')">Status</a><zem-help-popover ng-if="hasPermission('zemauth.help_view')" content="Status of an account (enabled or paused). An account is paused only if all its campaigns are paused, too; otherwise the account is enabled." placement="top"></zem-help-popover></th>
                            <th class="text-right arrow" ng-class="{'text-right': col.type !== 'url', ordered: order === '-' + col.field, 'ordered-reverse': order === col.field, 'trimmed-currency': (col.type === 'currency' && col.fractionSize > 2)}" ng-repeat="col in columns | filter: {checked: true}"><zem-internal-feature ng-if="col.internal"></zem-internal-feature><a href class="col-title order" ng-click="orderRows(col.field)">{{ col.name }}</a><zem-help-popover ng-if="col.help && hasPermission('zemauth.help_view')" content="{{ col.help }}" placement="{{ $last ? 'left' : 'top' }}"></zem-help-popover></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-if="loadRequestInProgress && !rows.length">
                            <td colspan="{{ selectedColumnsCount + 3}}" class="loader-row">
                                <div class="loader"></div>
                            </td>
                        </tr>
                        <tr ng-show="(!rows || !rows.length) && !loadRequestInProgress">
                            <td class="no-data" colspan="{{ selectedColumnsCount + 3}}">No data</td>
                        </tr>
                        <tr ng-repeat="row in rows">
                            <td>{{ row.name }}</td>
                            <td class="text-center">
                                <div ng-if="row.status == constants.adGroupSettingsState.ACTIVE">Enabled</div>
                                <div ng-if="row.status == constants.adGroupSettingsState.INACTIVE">Paused</div>
                                <div ng-if="!row.status">N/A</div>
                            </td>

                            <td class="text-right number" ng-repeat="col in columns | filter: {checked: true}">
                                <span ng-switch="col.type">
                                    <span ng-switch-when="currency">
                                        <span ng-class="{'currency-3': col.fractionSize === 3}">
                                            {{ (row[col.field] | decimalCurrency:"$":col.fractionSize:"") || 'N/A' }}
                                        </span>
                                    </span>
                                    <span ng-switch-when="percent">
                                        {{ (row[col.field] | number:2) || '0.0' }}%
                                    </span>
                                    <span ng-switch-when="number">
                                        {{ (row[col.field] | number:0) || 'N/A' }}
                                    </span>
                                    <span ng-switch-when="datetime">
                                        <span class="datetime">
                                            {{ (row[col.field] | date:'M/d/yyyy h:mm a') || 'N/A' }}
                                        </span>
                                    </span>
                                    <span ng-switch-when="link">
                                        <a ng-href="{{ row[col.field] }}" target="_blank"><img ng-src="{{ config.static_url }}/img/link.svg" class="link-img"></a>
                                    </span>
                                </span>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td>TOTALS</td>
                            <td class="text-right number"></td>
                            <td class="text-right number" ng-repeat="col in columns | filter: {checked: true, field: '!bid_cpc'}">
                                <span ng-switch="col.type">
                                    <span ng-if="col.field != 'last_sync'">
                                        <span ng-switch-when="currency">
                                            <span ng-class="{'currency-3': col.fractionSize === 3}">
                                                {{ (totals[col.field] | decimalCurrency:"$":col.fractionSize:"") || 'N/A' }}
                                            </span>
                                        </span>
                                        <span ng-switch-when="percent">
                                            {{ (totals[col.field] | number:2) || '0.0' }}%
                                        </span>
                                        <span ng-switch-when="number">
                                            {{ (totals[col.field] | number:0) || 'N/A' }}
                                        </span>
                                        <span ng-switch-when="datetime">
                                            {{ (row[col.field] | date:'M/d/yyyy h:mm a') || 'N/A' }}
                                        </span>
                                    </span>
                                </span>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div class="last-sync">
            <span ng-switch="lastSyncDate">
                <span ng-switch-when="null">
                    * Reporting metrics haven't been synced yet.
                </span>
                <span ng-switch-default>
                    * Reporting metrics synced {{ lastSyncDate.fromNow() }}. Service fee not included.
                </span>
            </span>
        </div>

        <div class="pagination" ng-show="rows">
            <span>Go to page</span>
            <form ng-submit="loadPage()">
                <input class="page-num form-control" type="number" min="1" max="{{ pagination.numPages }}" ng-model="pagination.currentPage">
            </form>

            <span>Show rows</span>
            <select ui-select2="{minimumResultsForSearch: -1, dropdownCssClass: 'show-rows'}" class="show-rows" ng-model="pagination.sizeTemp" ng-change="changePaginationSize()" data-placeholder="{{ pagination.size }}">
                <option value=""></option>
                <option ng-repeat="number in sizeRange" value="{{ number }}">{{ number }}</option>
            </select>

            <div ng-disabled="pagination.currentPage == 1" class="btn btn-default" ng-click="loadPage(1)"><img ng-src="{{ config.static_url }}/img/arrow-first.svg"></div>
            <div ng-disabled="pagination.currentPage == 1" class="btn btn-default" ng-click="loadPage(pagination.currentPage - 1)"><img ng-src="{{ config.static_url }}/img/arrow-prev.svg"></div>
            <span class="current-rows">{{ pagination.startIndex}} - {{ pagination.endIndex }} of {{ pagination.count }}</span>
            <div ng-disabled="pagination.currentPage == pagination.numPages" class="btn btn-default" ng-click="loadPage(pagination.currentPage + 1)"><img ng-src="{{ config.static_url }}/img/arrow-next.svg"></div>
            <div ng-disabled="pagination.currentPage == pagination.numPages" class="btn btn-default" ng-click="loadPage(pagination.numPages)"><img ng-src="{{ config.static_url }}/img/arrow-last.svg"></div>
        </pagination>
    </div>
    </div>
</div>
