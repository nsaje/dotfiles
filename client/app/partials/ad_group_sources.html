<div class="page page-ad-group-sources">
    <div class="section" ng-class="{'height-hidden': !isChartShown}">
        <zem-chart zem-data="chartData" zem-metric1="chartMetric1" zem-metric2="chartMetric2" zem-metric1-values="options.sourceChartMetrics" zem-metric2-values="options.sourceChartMetrics" zem-min-date="dateRange.startDate" zem-max-date="dateRange.endDate"></zem-chart>
    </div>

    <div class="section table-ad-group-sources">
        <div class="button-bar">
            <select ui-select2="{minimumResultsForSearch: -1}" ng-model="exportType" ng-change="downloadReport()" data-placeholder="Download Report" class="export">
                <option value=""></option>
                <option value="csv">CSV by day</option>
                <option value="excel">Excel by day</option>
            </select>
            <zem-custom-table-cols class='pull-right' columns='columns'></zem-custom-table-cols>

            <a id="chart-btn" ng-attr-title="{{ chartBtnTitle }}" class="btn btn-default pull-right" ng-click="toggleChart()"><img ng-src="{{ config.static_url }}/img/chart.svg"></a>

            <div class="clearfix"></div>
        </div>

        <alert type="info" class="alert-sync" ng-show="isSyncRecent === false">
            We are experiencing a delay synchronizing reporting metrics. <span ng-if="!!lastSyncDate">The last successful sync took place {{ lastSyncDate.fromNow() }}.</span> If you have any questions please contact us at <a href="mailto:help@zemanta.com">help@zemanta.com</a>.
        </alert>

        <table class="table">
            <thead>
                <tr>
                    <th></th>
                    <th>Source</th>
                    <th class="text-center">Status</th>
                    <th class="text-right" ng-repeat="col in columns | filter: {checked: true}">{{ col.name }}</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-if="loadRequestInProgress">
                    <td colspan="{{ selectedColumnsCount + 3}}" class="loader-row">
                        <img class="loader" ng-src="{{ config.static_url }}/img/loader.svg">
                    </td>
                </tr>
                <tr ng-show="(!rows || !rows.length) && !loadRequestInProgress">
                    <td class="no-data" colspan="{{ selectedColumnsCount + 3}}">No data</td>
                </tr>
                <tr ng-repeat="row in rows">
                    <td class="input-one-char"><input type="checkbox" data-ng-model="row.checked" ng-disabled="!row.checked && selectedSourceIds.length === 3" data-ng-change="selectedSourcesChanged(row.id)"/></td>
                    <td>{{ row.name }}</td>
                    <td class="text-center">
                        <div ng-if="row.status == constants.adGroupSettingsState.ACTIVE">Enabled</div>
                        <div ng-if="row.status == constants.adGroupSettingsState.INACTIVE">Paused</div>
                        <div ng-if="!row.status">N/A</div>
                    </td>

                    <td class="text-right number" ng-repeat="col in columns | filter: {checked: true}">
                        <span ng-switch="col.type">
                            <span ng-switch-when="currency">
                                {{ (row[col.field] | currency:"$") || 'N/A' }}
                            </span>
                            <span ng-switch-when="percent">
                                {{ (row[col.field] | number:2) || '0.0' }}%
                            </span>
                            <span ng-switch-when="number">
                                {{ (row[col.field] | number:0) || 'N/A' }}
                            </span>
                            <span ng-switch-when="datetime">
                                {{ (row[col.field] | date:'M/d/yyyy h:mm a') || 'N/A' }}
                            </span>
                        </span>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td class="input-one-char"><input type="checkbox" data-ng-model="selectedSourceTotals" data-ng-change="selectedSourcesChanged(null)"/></td>
                    <td colspan="2">TOTALS</td>
                    <td class="text-right number"></td>
                    <td class="text-right number" ng-repeat="col in columns | filter: {checked: true, field: '!bid_cpc'}">
                        <span ng-switch="col.type">
                            <span ng-if="col.field != 'last_sync'">
                                <span ng-switch-when="currency">
                                    {{ (totals[col.field] | currency:"$") || 'N/A' }}
                                </span>
                                <span ng-switch-when="percent">
                                    {{ (totals[col.field] | number:2) || '0.0' }}%
                                </span>
                                <span ng-switch-when="number">
                                    {{ (totals[col.field] | number:0) || 'N/A' }}
                                </span>
                                <span ng-switch-when="datetime">
                                    {{ (row[col.field] | date:'M/d/yyyy h:mm a') || 'N/A' }}
                                </span>
                            </span>
                        </span>
                    </td>
                </tr>
            </tfoot>
        </table>

        <div class="last-sync">
            <span ng-switch="lastSyncDate">
                <span ng-switch-when="null">
                    * Reporting metrics haven't been synced yet.
                </span>
                <span ng-switch-default>
                    * Reporting metrics synced {{Â lastSyncDate.fromNow() }}.
                </span>
            </span>
        </div>
    </div>
</div>
