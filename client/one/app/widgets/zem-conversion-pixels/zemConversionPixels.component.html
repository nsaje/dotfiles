<div class="white-background">
    <h2>Pixels</h2>
    <div class="description">Zemanta's pixels allow you to report conversions, build audiences and get insights about how people use your website.</div>
    <div class="loader" ng-show="$ctrl.state.requests.list.inProgress"></div>
    <div class="loader-container" ng-if="$ctrl.state.conversionPixels.length">
        <div class="loader" ng-show="$ctrl.state.conversionPixels.length && $ctrl.state.requests.list.inProgress"></div>
        <table class="table table-hover">
            <thead>
            <tr>
                <th class="arrow" ng-class="{ordered: $ctrl.orderField === 'name' && !$ctrl.orderReverse, 'ordered-reverse': $ctrl.orderField === 'name' && $ctrl.orderReverse}">
                    <a href class="order" ng-click="$ctrl.orderField = 'name'; $ctrl.orderReverse = !$ctrl.orderReverse">Name</a>
                    <zem-help-popover content="Pixel's name" placement="top"></zem-help-popover>
                </th>
                <th ng-if="$ctrl.hasPermission('zemauth.can_see_pixel_traffic')" is-internal="zemauth.can_see_pixel_traffic">
                    Last Triggered
                    <zem-help-popover content="Synchronized every 24 hours." placement="top"></zem-help-popover>
                </th>
                <th ng-if="$ctrl.hasPermission('zemauth.can_see_pixel_traffic')" is-internal="zemauth.can_see_pixel_traffic">
                    Traffic Yesterday
                    <zem-help-popover content="Number of times pixel triggered yesterday. Synchronized every 24 hours." placement="top"></zem-help-popover>
                </th>
                <th ng-if="$ctrl.hasPermission('zemauth.can_redirect_pixels')" is-internal="zemauth.can_redirect_pixels">
                    Redirected
                </th>

                <th ng-if="$ctrl.hasPermission('zemauth.can_see_pixel_notes')" is-internal="zemauth.can_see_pixel_notes">
                    Notes
                </th>
                <th></th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr ng-class="{'archived': item.archived}" ng-repeat="item in $ctrl.state.conversionPixels | orderBy:$ctrl.orderField:$ctrl.orderReverse | filter: $ctrl.filterConversionPixels">
                <td class="pixel-name">
                    {{ item.name }} <span ng-if="item.audienceEnabled" class="text-gray">(Custom audience pixel)</span>

                </td>
                <td ng-if="$ctrl.hasPermission('zemauth.can_see_pixel_traffic')">
                    {{ (item.lastTriggered | date:'M/d/yyyy h:mm a') || 'Never' }}
                </td>
                <td ng-if="$ctrl.hasPermission('zemauth.can_see_pixel_traffic')">
                    {{ item.impressions }}
                </td>
                <td ng-if="$ctrl.hasPermission('zemauth.can_redirect_pixels')">
                    {{ item.redirectUrl ? 'Yes' : 'No' }}
                </td>
                <td ng-if="$ctrl.hasPermission('zemauth.can_see_pixel_notes')">
                    {{ item.notes }}
                </td>
                <td>
                    <span class="loader" ng-if="$ctrl.state.requests.archive[item.id].inProgress || $ctrl.state.requests.restore[item.id].inProgress"></span>
                        <span ng-if="$ctrl.state.requests.archive[item.id].error || $ctrl.state.requests.restore[item.id].error" class="error">
                            An error has occured. Please contact support at <a href="mailto:help@zemanta.com">help@zemanta.com</a> if the error persists.
                        </span>
                </td>
                <td class="action-buttons">
                        <span ng-if="$ctrl.hasPermission('zemauth.archive_restore_entity') && !item.archived">
                            <zem-internal-feature ng-if="isPermissionInternal('zemauth.archive_restore_entity')" popover-placement="left"></zem-internal-feature>
                            <a tabindex="-1" ng-click="$ctrl.archiveConversionPixel(item)" href="#" class="button button--small button--with-icon archive-icon">Archive</a>
                        </span>
                        <span ng-if="$ctrl.hasPermission('zemauth.archive_restore_entity') && !!item.archived">
                            <zem-internal-feature ng-if="isPermissionInternal('zemauth.archive_restore_entity')" popover-placement="left"></zem-internal-feature>
                            <a tabindex="-1" ng-click="$ctrl.restoreConversionPixel(item)" href="#" class="button button--small button--with-icon archive-icon">Restore</a>
                        </span>
                        <span ng-if="!item.archived">
                            <a tabindex="-1" ng-click="$ctrl.copyConversionPixelTag(item)" href="#" class="button button--small button--with-icon copy-icon">Copy tag</a>
                        </span>
                        <span ng-if="!item.archived">
                            <a tabindex="-1" ng-click="$ctrl.editConversionPixel(item)" href="#" class="button button--small button--with-icon edit-icon">Edit pixel</a>
                        </span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <button type="button" class="button button--with-icon add-icon" ng-class="{'disabled': !!$ctrl.state.requests.list.inProgress || !!$ctrl.state.requests.list.error}" ng-click="$ctrl.addConversionPixel()">Add Pixel</button>
    <span ng-if="!!$ctrl.state.requests.list.error" class="error">
        An error has occurred while loading pixels. Please contact support at <a href="mailto:help@zemanta.com">help@zemanta.com</a> if the error persists.
    </span>
</div>

