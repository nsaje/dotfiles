<div class="modal-header">
    <h4 class="modal-title">Export Report</h4>
</div>
<div class="modal-body">
    <form class="form-horizontal" ng-submit="$ctrl.startReport()">

        <table>
            <tr>
                <td>Date range:</td>
                <td>{{ $ctrl.dateRange.startDate.format('ll') }} - {{ $ctrl.dateRange.endDate.format('ll') }}</td>
            </tr>
            <tr>
                <td>Breakdown:</td>
                <td>
                    <span ng-repeat="dimension in $ctrl.resolve.api.getBreakdown()" style="border: 1px solid; margin: 2px;">
                        <span>{{ dimension.name }}</span>
                    </span>
                </td>
            </tr>
            <tr>
                <td>Columns:</td>
                <td>
                    <div>
                        <span ng-repeat="field in $ctrl.selectedFields" style="border: 1px solid; margin: 2px;">
                            <span title="{{ field }}">{{ field }}</span>
                        </span>
                    </div>
                </td>
            </tr>
            <tr>
                <td>Filters:</td>
                <td>
                    <div ng-if="$ctrl.appliedFilterConditions.length">
                        <div>
                            <span ng-repeat="condition in $ctrl.appliedFilterConditions" style="border: 1px solid; margin: 2px;">
                                <span style="color: gray">{{condition.name}}</span>
                                <span title="{{condition.text}}">{{condition.text}}</span>
                            </span>
                        </div>
                    </div>
                </td>
            </tr>
        </table>

        <div class="form-group" ng-if="$ctrl.hasPermission('zemauth.can_include_totals_in_reports')">
            <div class="col-xs-4">
                <zem-internal-feature ng-if="$ctrl.isPermissionInternal('zemauth.can_include_totals_in_reports')" popover-placement="right">
                </zem-internal-feature>
                <label for="include-totals-checkbox" class="control-label">Include totals</label>
            </div>
            <div class="col-xs-4">
                <input id="include-totals-checkbox" type="checkbox" ng-model="$ctrl.includeTotals" class="checkbox">
            </div>
        </div>

        <div class="modal-footer">
            <button type="submit" class="btn btn-add btn-icon download" ng-show="!$ctrl.jobPosted" ng-disabled="$ctrl.jobPostingInProgress">
                <span class="icon"></span>
                <span class="text">Send to {{ $ctrl.user.email }}</span>
            </button>
            <button type="button" class="btn btn-blue btn-outline" ng-click="$ctrl.close()" ng-show="!$ctrl.jobPosted">
                <span class="text">Cancel</span>
            </button>
            <button type="button" class="btn btn-blue btn-outline" ng-click="$ctrl.close()" ng-show="$ctrl.jobPosted">
                <span class="text">Close</span>
            </button>
            <div class="loader" ng-show="$ctrl.jobPostingInProgress"></div>
            <span ng-show="$ctrl.jobPosted && $ctrl.jobPostedSuccessfully">We are preparing your report, check e-mail</span>
            <span ng-show="$ctrl.jobPosted && !$ctrl.jobPostedSuccessfully">Something went wrong</span>
        </div>

    </form>
</div>