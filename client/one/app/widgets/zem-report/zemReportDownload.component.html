<div class="modal__header">
    <div class="modal__title">Export Report</div>
</div>
<div class="modal__body">
    <h3>You are exporting a report with the following settings:</h3>
    <hr>
    <div class="form">
        <div class="form__group form__group--informative">
            <label class="form__label">Date range</label>
            <div class="form__information">{{ $ctrl.dateRange.startDate.format('ll') }} - {{ $ctrl.dateRange.endDate.format('ll') }}</div>
        </div>
        <div class="form__group form__group--informative">
            <label class="form__label">View</label>
            <div class="form__information">
                {{ $ctrl.view }}
            </div>
        </div>
        <div class="form__group form__group--informative">
            <label class="form__label">Breakdowns</label>
            <div class="form__information">
                <span ng-repeat="dimension in $ctrl.shownBreakdown" class="tag">{{ dimension.name }}</span>
            </div>
            <div class="form__label"></div>
            <div class="form__information" ng-if="$ctrl.availableBreakdowns.length">
              <ui-select
                      theme="select2"
                      search-enabled="false"
                      ng-model="$ctrl.addbreakdown"
                      ng-disabled="$ctrl.jobPosted"
                      class="button button--dropdown-toggle-icon button--with-icon add-icon button--dropdown-toggle-icon">
                  <ui-select-match placeholder="Add breakdown">Add breakdown</ui-select-match>
                  <ui-select-choices repeat="breakdown in $ctrl.availableBreakdowns">
                      <div ng-click="$ctrl.addBreakdown(breakdown)">{{breakdown.name}}</div>
                  </ui-select-choices>
              </ui-select>
            </div>
        </div>
        <div class="form__group form__group--informative">
            <label class="form__label">Columns</label>
            <div class="form__information">
                <span ng-repeat="field in $ctrl.shownSelectedFields" class="tag">{{ field }}</span>
                <a class="tag tag--show-more" ng-click="$ctrl.showAllSelectedFields()"
                   ng-if="$ctrl.shownSelectedFields.length < $ctrl.selectedFields.length">...</a>
            </div>
        </div>
        <div class="form__group form__group--informative" ng-if="$ctrl.appliedFilterConditions.length">
            <label class="form__label">Filters</label>
            <div class="form__information">
                <span ng-repeat="condition in $ctrl.shownAppliedFilterConditions" class="tag">{{condition.text}}</span>
                <a class="tag tag--show-more" ng-click="$ctrl.showAllAppliedFilters()"
                   ng-if="$ctrl.shownAppliedFilterConditions.length < $ctrl.appliedFilterConditions.length">...</a>
            </div>
        </div>
        <div class="form__group form__group--informative">
            <zem-internal-feature ng-if="$ctrl.isPermissionInternal('zemauth.can_include_totals_in_reports')" popover-placement="right"></zem-internal-feature>
            <label class="form__label" for="include-totals-checkbox">Include totals</label>
            <div class="form__checkbox">
                <label>
                    <input id="include-totals-checkbox" type="checkbox" ng-model="$ctrl.includeTotals" ng-disabled="$ctrl.jobPosted" class="input-checkbox">
                    <span class="checkbox-text"></span>
                </label>
            </div>
        </div>
        <div class="form__group" ng-if="$ctrl.hasPermission('zemauth.can_include_model_ids_in_reports')">
            <label class="form__label" for="add-ids-checkbox" is-internal="zemauth.can_include_model_ids_in_reports">Add IDs to report</label>
            <div class="form__checkbox">
                <label>
                    <input id="add-ids-checkbox"
                           type="checkbox"
                           ng-model="$ctrl.includeIds"
                           ng-disabled="$ctrl.jobPosted"
                           ng-change="$ctrl.update()"
                           class="input-checkbox">
                    <span class="checkbox-text" for="add-ids-checkbox"></span>
                </label>
            </div>
        </div>
        <div class="form__group" ng-if="$ctrl.showIncludeItemsWithNoSpend">
            <label class="form__label" for="add-missing-checkbox" >Include items with no spend</label>
            <div class="form__checkbox">
                <label>
                    <input id="add-missing-checkbox"
                           type="checkbox"
                           ng-model="$ctrl.includeItemsWithNoSpend"
                           ng-disabled="$ctrl.jobPosted"
                           class="input-checkbox">
                    <span class="checkbox-text" for="add-missing-checkbox"></span>
                </label>
            </div>
        </div>
        <hr>
        <div class="form__group">
            <label class="form__label" for="send-report-checkbox">Send report</label>
            <div class="form__checkbox">
                <label>
                    <input id="send-report-checkbox"
                           type="checkbox"
                           ng-model="$ctrl.sendReport"
                           ng-disabled="$ctrl.jobPosted"
                           class="input-checkbox">
                    <span class="checkbox-text" for="send-report-checkbox"></span>
                </label>
            </div>
        </div>
        <div class="form__group" ng-if="$ctrl.sendReport">
            <label class="form__label" for="recipients">Report will be sent to</label>
            <div class="form__information" id="recipients">
                {{ $ctrl.user.email }}
            </div>
        </div>
        <div class="form__group" ng-class="{'form__group--error': $ctrl.errors.details.options.recipients.length > 0}" ng-if="$ctrl.sendReport">
            <label class="form__label">Add more recipients</label>
            <textarea class="textarea" ng-model="$ctrl.recipients" placeholder="Comma-separated list of recipient email addresses" ng-disabled="$ctrl.jobPosted"></textarea>
            <div ng-repeat="error in $ctrl.errors.details.options.recipients" class="message message--error" for="recipients">{{ error }}</div>
        </div>
    </div>
</div>
<div class="modal__footer buttons-panel">
    <button type="submit" class="button button--highlight button--with-icon send-icon" ng-click="$ctrl.startReport()" ng-show="!$ctrl.jobDone" ng-disabled="$ctrl.jobPosted" ng-if="$ctrl.sendReport">Send</button>
    <button type="submit" class="button button--highlight button--with-icon download-icon" ng-click="$ctrl.startReport()" ng-show="!$ctrl.jobDone" ng-disabled="$ctrl.jobPosted" ng-if="!$ctrl.sendReport">Download</button>
    <button type="button" class="button button--outline" ng-click="$ctrl.cancel()" ng-show="!$ctrl.jobDone">Cancel</button>
    <button type="button" class="button button--outline" ng-click="$ctrl.close()" ng-show="$ctrl.jobDone">Close</button>
    <div class="loader" ng-show="$ctrl.jobPosted && !$ctrl.jobDone"></div>
    <span ng-show="$ctrl.reportSent">Requested report will be sent to your inbox shortly.</span>
    <span ng-if="$ctrl.reportUrl">Requested report can be downloaded here: <a href="{{ $ctrl.reportUrl }}" target="_blank">Download Report</a></span>
    <span class="message message--error" ng-repeat="error in $ctrl.errors.details.nonFieldErrors">{{ error }}</span>
    <span class="message message--error" ng-if="$ctrl.hasError && !$ctrl.errors.details.nonFieldErrors">An error has occured. Please contact support at <a href="mailto:help@zemanta.com">help@zemanta.com</a> if the error persists.</span>
</div>
