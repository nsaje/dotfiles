<div class="zem-settings-component__container zem-settings-component__container--automatic-mode"
     ng-if="$ctrl.hasPermission('zemauth.can_set_adgroup_to_auto_pilot') && !$ctrl.hasPermission('zemauth.can_set_ad_group_mode')"
     is-internal="zemauth.can_set_adgroup_to_auto_pilot">
    <div class="zem-settings-component__header">Autopilot</div>
    <div class="zem-settings-component__description">Bids and Daily Spend Caps Automation Settings.</div>
    <div class="message message--warning message--with-icon" ng-if="$ctrl.isInLanding()">
        You canâ€™t change autopilot setting while the campaign is in landing mode.
    </div>
    <div class="form">
        <div ng-repeat='autopilotState in $ctrl.options.adGroupSettingsAutopilotStates'>
            <div class="form__radio m-b-xs">
                <label>
                    <input class="input-radio" id="{{ autopilotState.value }}" type="radio" ng-model="$ctrl.entity.settings.autopilotState" ng-value="autopilotState.value" ng-disabled="$ctrl.isInLanding()">
                    <span class="radio-text">{{ autopilotState.name }} <zem-help-popover content="{{autopilotState.help}}" placement="right"></zem-help-popover></span>
                </label>
            </div>

            <div class="form__indented" ng-if="autopilotState.value === $ctrl.constants.adGroupSettingsAutopilotState.INACTIVE && $ctrl.hasPermission('zemauth.can_see_rtb_sources_as_one') && autopilotState.value === $ctrl.entity.settings.autopilotState">
                <label class="form__label" is-internal="zemauth.can_see_rtb_sources_as_one">Manage Daily Spend Caps of RTB sources:</label>

                <div class="form__radio">
                    <label>
                        <input class="input-radio" type="radio" id="separately"
                               ng-model="$ctrl.entity.settings.b1SourcesGroupEnabled" ng-value="false">
                        <span class="radio-text" for="separately">
                            Separately
                            <zem-help-popover content="Set Daily Spend Cap for each of the RTB sources." placement="right"></zem-help-popover>
                        </span>
                    </label>
                </div>
                <div class="form__radio">
                    <label>
                        <input class="input-radio" type="radio" id="as-one"
                               ng-model="$ctrl.entity.settings.b1SourcesGroupEnabled" ng-value="true">
                        <span class="radio-text" for="as-one">
                            As one
                            <zem-help-popover content="Set one Daily Spend Cap for all RTB sources together." placement="right"></zem-help-popover>
                        </span>
                    </label>
                </div>
            </div>
            <div class="form__indented" ng-if="autopilotState.value === $ctrl.constants.adGroupSettingsAutopilotState.ACTIVE_CPC_BUDGET && autopilotState.value === $ctrl.entity.settings.autopilotState">
                <div class="form__group" ng-class="{'form--error': !!$ctrl.errors.autopilotBudget}">
                    <label class="form__label" for="autopilot-budget">
                        Ad Group's Daily Spend Cap
                        <zem-help-popover content="Amount of budget Autopilot can operate with on this Ad Group every day." placement="top"></zem-help-popover>
                    </label>
                    <div class="prefixed-field prefixed-field--narrow">
                        <span class="prefixed-field__prefix">$</span>
                        <input class="input-text" id="autopilot-budget" type="text" ng-model="$ctrl.entity.settings.autopilotBudget" fraction-size="0"
                            zem-currency-input ng-disabled="$ctrl.isInLanding()">
                    </div>
                    <div class="message message--error" ng-repeat="error in $ctrl.errors.autopilotBudget" for="autopilot-budget">{{ error }}</div>
                </div>

                <div class="message message--info message--with-icon">
                    Autopilot will optimize media sources' daily spend caps for <b>{{$ctrl.getBudgetAutopilotOptimizationGoalText()}}</b>
                    and try to hit the ad group's daily spend cap. To change optimization objective please change
                    Primary Campaign Goal in Campaign Settings.<br/>
                    <i>{{$ctrl.getBudgetAutopilotOptimizationCPAGoalText()}}</i>
                </div>
            </div>
        </div>
        <div class="message message--error" ng-repeat="error in $ctrl.errors.autopilotState">{{ error }}</div>
    </div>
</div>
