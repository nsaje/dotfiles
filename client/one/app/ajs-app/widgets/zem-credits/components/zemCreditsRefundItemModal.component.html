<div class="modal__header">
    <div class="modal__title">
        Credit Item #{{ $ctrl.state.creditItem.id }} refund
    </div>
</div>
<div class="modal__body">
    <p>
        Refund for credit item created by
        <strong>{{ $ctrl.state.creditItem.createdBy }}</strong> on
        <strong>{{ $ctrl.state.creditItem.createdOn }}</strong>
    </p>
    <hr />
    <div class="form" id="form-credits-refund-item">
        <div
            class="form__group"
            ng-class="{'form--error': !!$ctrl.state.requests.saveCreditRefundItem.errors.startDate}"
        >
            <label class="form__label" for="date-input">Refund for month</label>
            <div
                class="prefixed-field prefixed-field--narrow prefixed-field--with-icon calendar-icon"
            >
                <input
                    class="input-text"
                    id="date-input"
                    type="text"
                    uib-datepicker-popup="MM/yyyy"
                    ng-model="$ctrl.state.creditRefundItem.startDate"
                    datepicker-options="$ctrl.datePickerOptions"
                    is-open="$ctrl.isDatePickerOpen"
                    ng-click="$ctrl.openDatePicker()"
                />
            </div>
            <div
                ng-repeat="error in $ctrl.state.requests.saveCreditRefundItem.errors.startDate"
                class="message message--error"
                for="date-input"
            >
                {{ error }}
            </div>
        </div>
        <div
            class="form__group"
            ng-class="{'form--error': !!$ctrl.state.requests.saveCreditRefundItem.errors.accountId}"
        >
            <label class="form__label" for="account-id-select"
                >Refunded Account</label
            >
            <ui-select
                class="button button--plain button--narrow button--dropdown-toggle-icon"
                theme="select2"
                id="account-id-select"
                ng-model="$ctrl.selectedAccount"
                ng-change="$ctrl.onSelectedAccountChange()"
                ng-disabled="$ctrl.isAccountSelectDisabled"
                search-enabled="true"
            >
                <ui-select-match>{{ $select.selected.name }}</ui-select-match>
                <ui-select-choices
                    repeat="account in $ctrl.accounts | filter: $select.search"
                    class="ui-select-choices"
                >
                    <span
                        ng-bind-html="account.name | highlight: $select.search"
                    ></span>
                </ui-select-choices>
            </ui-select>
            <div
                class="message message--error"
                ng-repeat="error in $ctrl.state.requests.saveCreditItem.errors.licenseFee"
                for="account-id-select"
            >
                {{ error }}
            </div>
        </div>
        <div class="form__group">
            <label class="form__label" for="media-amount-input"
                >Refunded Media Amount</label
            >
            <div
                class="prefixed-field postfixed-field prefixed-field--narrow postfixed-field--narrow"
            >
                <span class="prefixed-field__prefix">{{
                    $ctrl.state.creditItem.currencySymbol
                }}</span>
                <input
                    class="input-text"
                    id="media-amount-input"
                    type="text"
                    ng-model="$ctrl.mediaAmount"
                    fraction-size="0"
                />
                <span class="postfixed-field__postfix">.00</span>
            </div>
        </div>
        <div class="form__group form__group--informative">
            <label class="form__label">Credit License Fee</label>
            <div class="form__information">
                {{ $ctrl.state.creditItem.licenseFee }}%
            </div>
        </div>
        <div
            class="form__group"
            ng-class="{'form--error': !!$ctrl.state.requests.saveCreditRefundItem.errors.effectiveMargin}"
        >
            <label class="form__label" for="effective-margin-input"
                >Refunded Margin</label
            >
            <div class="postfixed-field postfixed-field--narrow">
                <input
                    id="effective-margin-select"
                    class="input-text"
                    ng-model="$ctrl.state.creditRefundItem.effectiveMargin"
                />
                <span class="postfixed-field__postfix">%</span>
            </div>
            <div
                class="message message--error"
                ng-repeat="error in $ctrl.state.requests.saveCreditRefundItem.errors.effectiveMargin"
                for="effective-margin-input"
            >
                {{ error }}
            </div>
        </div>
        <div
            class="form__group form__group--informative"
            ng-class="{'form--error': !!$ctrl.state.requests.saveCreditRefundItem.errors.amount}"
        >
            <label class="form__label">Total Refunded Amount</label>
            <div class="form__information">
                {{
                    $ctrl.calculateTotalAmount()
                        | decimalCurrency
                            : $ctrl.state.creditItem.currencySymbol
                            : 0
                }}
            </div>
            <div
                ng-repeat="error in $ctrl.state.requests.saveCreditRefundItem.errors.amount"
                class="message message--error"
            >
                {{ error }}
            </div>
        </div>
        <div
            class="form__group"
            ng-class="{'form--error': !!$ctrl.state.requests.saveCreditRefundItem.errors.comment}"
        >
            <label class="form__label" for="comment-input">Custom Notes</label>
            <textarea
                class="textarea"
                id="comment-input"
                type="text"
                ng-model="$ctrl.state.creditRefundItem.comment"
                maxlength="256"
            ></textarea>
            <div
                class="message message--error"
                ng-repeat="error in $ctrl.state.requests.saveCreditRefundItem.errors.comment"
                for="comment-input"
            >
                {{ error }}
            </div>
        </div>
        <hr />
    </div>
</div>
<div class="modal__footer buttons-panel">
    <button
        type="button"
        class="button button--highlight button--with-icon check-icon"
        ng-click="$ctrl.saveCreditRefundItem()"
        ng-disabled="$ctrl.state.requests.saveCreditRefundItem.inProgress"
    >
        Save
    </button>
    <button
        type="button"
        class="button button--outline"
        ng-click="$ctrl.discardCreditRefundItem()"
        ng-disabled="$ctrl.state.requests.saveCreditRefundItem.inProgress"
    >
        Cancel
    </button>
    <div
        class="loader"
        ng-show="$ctrl.state.requests.saveCreditRefundItem.inProgress"
    ></div>
    <span
        ng-show="!!$ctrl.state.requests.saveCreditRefundItem.errors"
        class="message message--error"
        >An error occurred while saving.</span
    >
</div>
