<div class="zem-rule-form-condition__operand-container">
    <zem-select-input
        class="zem-rule-form-condition__operand-select zem-select-input"
        [value]="ruleCondition.firstOperand"
        bindLabel="label"
        bindValue="type"
        [items]="availableFirstOperands"
        [isSearchable]="false"
        groupByValue="group"
        [isClearable]="false"
        (valueChange)="selectFirstOperand($event)"
    ></zem-select-input>
    <ng-template #firstOperandModifierPopoverTemplate>
        <zem-rule-form-condition-modifier
            class="zem-rule-form-condition-modifier"
            [value]="ruleCondition.firstOperandValue"
            [valueLabel]="selectedFirstOperandConfig.label"
            [timeRange]="ruleCondition.firstOperandTimeRange"
            [hasTimeRangeModifier]="
                selectedFirstOperandConfig.hasTimeRangeModifier
            "
            [valueModifier]="selectedFirstOperandConfig.valueModifier"
            (valueChange)="updateFirstOperandValue($event)"
            (timeRangeChange)="updateFirstOperandTimeRange($event)"
        >
        </zem-rule-form-condition-modifier>
    </ng-template>
    <button
        class="zem-rule-form-condition__modifiers-toggle button button--plain button--with-icon button--only-icon dots-icon"
        [zemPopover]="firstOperandModifierPopoverTemplate"
        [disabled]="!areModifiersAvailable(selectedFirstOperandConfig)"
        autoClose="outside"
        placement="bottom"
    ></button>
</div>
<zem-select-input
    class="zem-rule-form-condition__operator zem-select-input"
    [value]="ruleCondition.operator"
    bindLabel="label"
    bindValue="operator"
    [items]="availableOperators"
    [isDisabled]="availableOperators.length === 0"
    [isSearchable]="false"
    [isClearable]="false"
    (valueChange)="selectOperator($event)"
></zem-select-input>
<div class="zem-rule-form-condition__operand-container">
    <zem-integer-input
        class="zem-decimal-input zem-rule-form-condition__absolute-value-input"
        *ngIf="
            selectedSecondOperandConfig &&
            selectedSecondOperandConfig.hasValue &&
            !selectedSecondOperandConfig.unit &&
            selectedSecondOperandConfig.dataType === DataType.Integer
        "
        [value]="ruleCondition.secondOperandValue"
        (inputBlur)="updateSecondOperandValue($event)"
    ></zem-integer-input>
    <zem-decimal-input
        class="zem-decimal-input zem-rule-form-condition__absolute-value-input"
        *ngIf="
            selectedSecondOperandConfig &&
            selectedSecondOperandConfig.hasValue &&
            !selectedSecondOperandConfig.unit &&
            selectedSecondOperandConfig.dataType === DataType.Decimal
        "
        [value]="ruleCondition.secondOperandValue"
        [fractionSize]="selectedSecondOperandConfig.fractionSize"
        (inputBlur)="updateSecondOperandValue($event)"
    ></zem-decimal-input>
    <!-- TODO (automation-rules): Use zem-text-input component -->
    <input
        #secondOperandStringValue
        class="zem-input-text zem-rule-form-condition__absolute-value-input"
        type="text"
        *ngIf="
            selectedSecondOperandConfig &&
            selectedSecondOperandConfig.hasValue &&
            selectedSecondOperandConfig.dataType === DataType.String
        "
        [ngModel]="ruleCondition.secondOperandValue"
        (blur)="updateSecondOperandValue(secondOperandStringValue.value)"
    />
    <zem-prefixed-input
        class="zem-prefixed-input zem-rule-form-condition__absolute-value-input"
        *ngIf="
            selectedSecondOperandConfig &&
            selectedSecondOperandConfig.hasValue &&
            selectedSecondOperandConfig.unit &&
            selectedSecondOperandConfig.dataType === DataType.Decimal
        "
        [prefix]="getUnitText(selectedSecondOperandConfig.unit)"
    >
        <zem-decimal-input
            class="zem-decimal-input"
            [value]="ruleCondition.secondOperandValue"
            [fractionSize]="selectedSecondOperandConfig.fractionSize"
            (inputBlur)="updateSecondOperandValue($event)"
        ></zem-decimal-input>
    </zem-prefixed-input>
    <zem-currency-input
        class="zem-currency-input zem-rule-form-condition__absolute-value-input"
        *ngIf="
            selectedSecondOperandConfig &&
            selectedSecondOperandConfig.hasValue &&
            selectedSecondOperandConfig.dataType === DataType.Currency
        "
        [value]="ruleCondition.secondOperandValue"
        [fractionSize]="selectedSecondOperandConfig.fractionSize"
        [currencySymbol]="getUnitText(selectedSecondOperandConfig.unit)"
        (inputBlur)="updateSecondOperandValue($event)"
    ></zem-currency-input>
    <zem-date-input
        class="zem-date-input zem-rule-form-condition__absolute-value-input"
        *ngIf="
            selectedSecondOperandConfig &&
            selectedSecondOperandConfig.hasValue &&
            selectedSecondOperandConfig.dataType === DataType.Date
        "
        [value]="ruleCondition.secondOperandValue"
        (valueChange)="updateSecondOperandValue($event)"
    ></zem-date-input>
    <zem-select-input
        class="zem-rule-form-condition__operand-select zem-select-input"
        [value]="ruleCondition.secondOperand"
        bindLabel="label"
        bindValue="type"
        [items]="availableSecondOperands"
        [isDisabled]="availableSecondOperands.length === 0"
        [isSearchable]="false"
        groupByValue="group"
        [isClearable]="false"
        (valueChange)="selectSecondOperand($event)"
    ></zem-select-input>
    <ng-template #secondOperandModifierTemplate>
        <zem-rule-form-condition-modifier
            class="zem-rule-form-condition-modifier"
            [value]="ruleCondition.secondOperandValue"
            [valueLabel]="selectedSecondOperandConfig.label"
            [timeRange]="ruleCondition.secondOperandTimeRange"
            [hasTimeRangeModifier]="
                selectedSecondOperandConfig.hasTimeRangeModifier
            "
            [valueModifier]="selectedSecondOperandConfig.valueModifier"
            (valueChange)="updateSecondOperandValue($event)"
            (timeRangeChange)="updateSecondOperandTimeRange($event)"
        >
        </zem-rule-form-condition-modifier>
    </ng-template>
    <button
        class="zem-rule-form-condition__modifiers-toggle button button--plain button--with-icon button--only-icon dots-icon"
        [zemPopover]="secondOperandModifierTemplate"
        [disabled]="!areModifiersAvailable(selectedSecondOperandConfig)"
        autoClose="outside"
        placement="bottom"
    ></button>
</div>
<button
    class="zem-rule-form-condition__remove-button button button--with-icon button--only-icon remove-icon"
    (click)="removeCondition()"
></button>
