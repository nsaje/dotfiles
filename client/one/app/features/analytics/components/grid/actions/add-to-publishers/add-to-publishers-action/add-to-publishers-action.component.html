<button
    class="zem-button"
    (click)="addToPublishersModal.open()"
    [disabled]="buttonDisabled"
>
    Add to Publishers & placements list
</button>

<zem-modal
    #addToPublishersModal
    [canCloseOnBackdropClick]="false"
    [canCloseOnEscapeKey]="true"
    (onClose)="store.reset()"
    class="zem-modal"
>
    <ng-container
        *ngIf="addToPublishersModal.isOpen && store.state$ | async as state"
    >
        <div class="zem-modal__header">
            <div class="zem-modal__title">
                {{
                    state.mode === 'add'
                        ? 'Add to Publishers & placements list'
                        : 'Create new Publishers & placements list'
                }}
            </div>
        </div>
        <div class="zem-modal__body">
            <zem-add-to-publishers-form
                *ngIf="state.mode === 'add'"
                class="zem-add-to-publishers-form"
                [availablePublisherGroups]="state.availablePublisherGroups"
                [publisherGroup]="state.activeEntity.entity"
                [publisherGroupErrors]="state.activeEntity.fieldsErrors"
                [searchInProgress]="state.requests.listExplicit.inProgress"
                (switchToCreate)="store.setMode('create')"
                (search)="search($event)"
                (publisherGroupSelected)="store.setActiveEntity($event)"
            >
            </zem-add-to-publishers-form>
            <zem-publisher-group-edit-form
                *ngIf="state.mode === 'create'"
                class="zem-publisher-group-edit-form"
                [publisherGroup]="state.activeEntity.entity"
                [publisherGroupErrors]="state.activeEntity.fieldsErrors"
                [showFileUpload]="false"
                (publisherGroupChange)="store.changeActiveEntity($event)"
            >
            </zem-publisher-group-edit-form>
        </div>
        <div
            class="zem-modal__footer zem-buttons-panel zem-add-to-publishers-action__buttons-panel"
        >
            <button
                *ngIf="state.requests.addEntries.inProgress"
                class="zem-button zem-button--highlighted zem-button--loading zem-add-to-publishers-action__loading-button"
                disabled
            ></button>
            <button
                *ngIf="!state.requests.addEntries.inProgress"
                class="zem-button zem-button--highlighted zem-button--with-icon"
                [ngClass]="{
                    'zem-button--add-icon': state.mode === 'add',
                    'zem-button--check-icon': state.mode === 'create'
                }"
                (click)="save()"
            >
                {{ state.mode === 'add' ? 'Add' : 'Save' }}
            </button>
            <button
                class="zem-button zem-button--outlined"
                [disabled]="state.requests.addEntries.inProgress"
                (click)="close()"
            >
                Cancel
            </button>
            <div
                *ngIf="
                    state.activeEntity.fieldsErrors.id ||
                    state.activeEntity.fieldsErrors.accountId ||
                    state.activeEntity.fieldsErrors.agencyId
                "
                class="zem-message zem-message--error zem-add-to-publishers-action__entries-error"
            >
                {{ state.activeEntity.fieldsErrors.id }}
                {{ state.activeEntity.fieldsErrors.accountId }}
                {{ state.activeEntity.fieldsErrors.agencyId }}
            </div>
        </div>
    </ng-container>
</zem-modal>
