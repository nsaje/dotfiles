<div class="page page-ad-group-sources">
    <div class="section">
        <div class="graph-infobox-parent" ng-class="{'graph-collapsed': !graphVisible}">
            <div class="graph-infobox-row">
                <div class="graph-container">
                    <zem-chart zem-data="chartData" zem-metric1="chartMetric1" zem-metric2="chartMetric2" zem-metric-options="chartMetricOptions" zem-min-date="dateRange.startDate" zem-max-date="dateRange.endDate" zem-on-remove="selectedSourceRemoved(id)" local-storage-prefix="localStoragePrefix"></zem-chart>
                </div>
                <div class="spacing"></div>
                <div class="infobox-container">
                    <zem-infobox class="infobox-wrapper" header="infoboxHeader" basic-settings="infoboxBasicSettings" performance-settings="infoboxPerformanceSettings" link-to="infoboxLinkTo" state-id="$state.params.id"></zem-infobox>
                </div>
            </div>
        </div>
    </div>
    <div class="section table-ad-group-sources" ng-if="!(hasPermission('zemauth.can_access_table_breakdowns_feature_on_ad_group_level') && hasPermission('zemauth.hide_old_table_on_ad_group_level'))">
        <div class="button-bar">
            <div ng-if="hasPermission('zemauth.ad_group_sources_add_source')" class="button-bar-item add-source-container">
                <zem-internal-feature ng-if="isPermissionInternal('zemauth.ad_group_sources_add_source')" popover-placement="bottom"></zem-internal-feature>
                <zem-dropdown
                        zem-placeholder="+ Media Sources"
                        zem-no-matches-placeholder="All sources added"
                        zem-dropdown-options="sources"
                        zem-css-class="add-source"
                        zem-on-select="addSource(selected)"
                        zem-dropdown-css-class="add-source-dropdown">
                </zem-dropdown>
            </div>
            <div class="button-bar-item pull-right">
                <zem-export
                    base-url="'api/ad_groups/' + $state.params.id + '/sources/'"
                    options="exportOptions"
                    columns="columns"
                    order="order"
                    level="level"
                    export-sources="true"
                    zem-has-permission="hasPermission"
                    zem-is-permission-internal="isPermissionInternal">
                </zem-export>
            </div>

            <zem-custom-table-cols class="pull-right" columns="columns" categories="columnCategories" local-storage-prefix="localStoragePrefix"></zem-custom-table-cols>
        </div>

        <div uib-alert class="alert-warning alert-sync" ng-show="sourcesWaiting.length">
            We are adding the following media source(s): {{sourcesWaiting.join(', ')}}. This may take some time.
        </div>
        <div uib-alert class="alert-warning alert-sync" ng-show="!isSyncRecent">
            We are experiencing a delay synchronizing reporting metrics. <span ng-if="!!lastSyncDate">The last successful sync took place {{ lastSyncDate.fromNow() }}.</span>
            If you have any questions please contact us at <a href="mailto:help@zemanta.com">help@zemanta.com</a>.
        </div>
        <div uib-alert class="alert-success alert-auto-pilot-changes" ng-show="autopilotChanges">
            Following Your change to a Media Source's state, Autopilot has successfully adjusted daily spend caps of the following Media Sources: {{autopilotChanges}}.
        </div>

        <zem-alerts level="grid.level" entity-id="grid.entityId"></zem-alerts>
        <zem-table zem-table-columns="columns" zem-table-rows="rows" zem-table-total-row="totals" zem-table-notifications="notifications" zem-table-show-loader="loadRequestInProgress" zem-table-order="order" zem-table-order-callback="orderTableData(order)" zem-table-data-status="dataStatus"></zem-table>
    </div>

    <div class="section zem-internal-feature-container white-background" ng-if="hasPermission('zemauth.can_access_table_breakdowns_feature_on_ad_group_level')">
        <zem-internal-feature ng-if="isPermissionInternal('zemauth.can_access_table_breakdowns_feature_on_ad_group_level')"></zem-internal-feature>

        <div class="button-bar" ng-if="grid.api">
            <div ng-if="hasPermission('zemauth.ad_group_sources_add_source')" class="button-bar-item add-source-container">
                <zem-internal-feature ng-if="isPermissionInternal('zemauth.ad_group_sources_add_source')" popover-placement="bottom"></zem-internal-feature>
                <zem-dropdown
                        zem-placeholder="+ Media Sources"
                        zem-no-matches-placeholder="All sources added"
                        zem-dropdown-options="sources"
                        zem-css-class="add-source"
                        zem-on-select="addSource(selected)"
                        zem-dropdown-css-class="add-source-dropdown">
                </zem-dropdown>
            </div>
            <div ng-if="hasPermission('zemauth.bulk_actions_on_all_levels')" class="button-bar-item">
                <zem-internal-feature ng-if="isPermissionInternal('zemauth.bulk_actions_on_all_levels')" popover-placement="bottom"></zem-internal-feature>
                <zem-grid-bulk-actions api="grid.api"></zem-grid-bulk-actions>
            </div>
            <zem-grid-export api="grid.api" class="pull-right"></zem-grid-export>
            <zem-grid-column-selector api="grid.api" class="pull-right"></zem-grid-column-selector>
            <zem-grid-breakdown-selector api="grid.api" class="pull-right"></zem-grid-breakdown-selector>
        </div>
        <zem-alerts level="grid.level" entity-id="grid.entityId"></zem-alerts>
        <zem-grid-integration
                api="grid.api"
                level="grid.level"
                breakdown="grid.breakdown"
                entity-id="grid.entityId"
                options="grid.options"

                selection="selection"
                selection-callback="updateSelectedRowsData"

                zem-has-permission="hasPermission"
                zem-is-permission-internal="isPermissionInternal">
        </zem-grid-integration>
    </div>
</div>
